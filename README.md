##### <i>??? : RxSwift ì“°ëŠ”ë° ì™œ ReactorKitì€ ì•ˆì¼ìŒ? Me : ê·¸ëŸ¬ê²Œìš”...</i>


# ğŸ¥³ê·¸ë˜ì„œ ì •ë¦¬í•©ë‹ˆë‹¤! ReactorKit!ğŸ¥³

ì´ ì €ì¥ì†ŒëŠ” [ReactorKit](https://github.com/ReactorKit/ReactorKit)ì„ ê³µë¶€í•˜ë©´ì„œ ì •ë¦¬í•˜ëŠ” ì €ì¥ì†Œì…ë‹ˆë‹¤! ì •ë¦¬í•˜ëŠ” ëª¨ë“  ë‚´ìš©ì€ [ê³µì‹ GitHub README](https://github.com/ReactorKit/ReactorKit)ë¥¼ ì°¸ê³ í•˜ì—¬ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.
#### â—ï¸ì •ë¦¬í•˜ëŠ” ëª¨ë“  ë‚´ìš©ì€ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°, MVVM, RxSwift, RxCocoaì— ëŒ€í•œ ê¸°ë³¸ ì§€ì‹ì´ ìˆë‹¤ëŠ”ê²ƒì„ ì „ì œë¥¼ ë‘ê³  ì •ë¦¬ëœ ë‚´ìš©ì…ë‹ˆë‹¤!

### 8/29
ì´ì œ ReactorKitì„ ë‹¤ë¤„ë³¼ë ¤í•œë‹¤. RxSwiftë¥¼ ì¨ì„œ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì„ í•˜ëŠ”ê±´ ìµìˆ™í•œë°, ReactorKitì„ ì“°ì§€ì•Šì€ í˜•íƒœë¡œ í•´ì„œ ê·¸ëŸ°ì§€, ì‘ì„±í–ˆë˜ ì½”ë“œë“¤ì´ ì¢€ ë”ëŸ½ë‹¤ ë¼ëŠ” ëŠë‚Œì„ ë°›ì•„ ReactorKitì„ ê³µë¶€í•´ë³´ë©´ ì–´ë–¨ê¹Œ ì‹¶ì–´ì„œ í•œë²ˆ ë„ì „í•´ë³¸ë‹¤. ì˜¤ëŠ˜ì€ ì¼ë‹¨ ê°„ë‹¨í•˜ê²Œë§Œ....

### 8/31
Global State.... ì „ì—­ìƒíƒœì— ëŒ€í•´ì„œ ì¡°ê¸ˆ ë” íŒŒê³ ë“¤ì–´ë´ì•¼í• ê±°ê°™ë‹¤.... ìƒê°í•´ë³´ë‹ˆ ì „ì—­ìƒíƒœë¼ëŠ”ê±¸ ê¹Šê²Œ ìƒê°í•´ë³´ì§€ ì•Šì€ê±°ê°™ì€ë°... ì „ì—­ë³€ìˆ˜ë‘ì€ ë‹¤ë¥¸ê±¸ê¹Œ...

### 9/1
ì „ì—­ìƒíƒœì— ëŒ€í•´ì„œ ë§ì´ ì°¾ì•„ë´¤ë‹¤. Reduxì—ì„œ ë‚˜ì˜¨ ê°œë…ì´ë¼ ìƒì†Œí–ˆìœ¼ë‚˜, ê²°êµ­ ë§ ê·¸ëŒ€ë¡œ ì „ì—­ì—ì„œ ì“°ì´ëŠ” ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ì„ ë§í•˜ëŠ”ê±°ì˜€êµ¬ë‚˜... ì´ì œ ë¦¬ë“œë¯¸ëŠ” ì •ë¦¬ ë!

# What is ReactorKit?

## ê¸°ë³¸ ê°œë…

ReactorKitì€ RxSwift, RxCocoa ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ê³¼ MVVM ë””ìì¸íŒ¨í„´ì„ ê°€ì§„ í”„ë¡œì íŠ¸ì— ìµœì¡°ì˜ ì‹œë„ˆì§€ë¥¼ ê°€ì§„ í”„ë ˆì„ì›Œí¬ì´ë‹¤. MVVM ë””ìì¸íŒ¨í„´ì´ ì ìš©ëœ í”„ë¡œì íŠ¸ì—ì„œ RxSwift ë¥¼ ì‚¬ìš©í•œ í”„ë¡œì íŠ¸ë“¤ì„ ë³´ë©´ Input/Output êµ¬ì¡°ë¥¼ ì‚¬ìš©í•œ í”„ë¡œì íŠ¸ë“¤ì´ ë‹¤ìˆ˜ ì¡´ì¬í•œë‹¤. ì´ Input/Output êµ¬ì¡°ë¥¼ ì²´ê³„í™”í•œ í”„ë ˆì„ì›Œí¬ê°€ ReactorKit ì´ë¼ê³  ë³´ë©´ ëœë‹¤.

<p float = "middle">
  <img width = "450" src="https://cloud.githubusercontent.com/assets/931655/25073432/a91c1688-2321-11e7-8f04-bf91031a09dd.png" />
</p>

ìœ„ ê·¸ë¦¼ì€ ReactorKitì´ ì–´ë–¤ì‹ìœ¼ë¡œ êµ´ëŸ¬ê°€ëŠ”ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ê·¸ë¦¼ì¸ë° Viewì—ì„œ ë‚˜ì˜¨ í™”ì‚´í‘œê°€ Actionì„ í†µê³¼í•œ ë’¤, Reactorì—ì„œ ëë‚˜ê³ , ì´í›„ Reactorì—ì„œ ë‚˜ì˜¨ í™”ì‚´í‘œê°€ Stateë¥¼ í†µê³¼í•œ ë’¤, Viewì—ì„œ ëë‚œë’¤ ê³„ì† ì‚¬ì´í´ì´ ëŒì•„ê°€ëŠ” ëª¨ìŠµì´ë‹¤.

ê°ê°ì„ ì„¤ëª…í•˜ìë©´ ì•„ë˜ì™€ ê°™ë‹¤.
- View : MVVM ì—ì„œì˜ View, VC ì™€ ë¹„ìŠ·í•œ ì˜ë¯¸
- Action : Viewì—ì„œ ë°œìƒëœ ì´ë²¤íŠ¸(ì˜ˆë¥¼ë“¤ì–´, button.rx.tap)ê°€ Reactorë¡œ ì „ë‹¬ë˜ëŠ” í˜•íƒœ(ë‹¨ìœ„)
- Reactor : MVVM ì—ì„œì˜ ViewModel ê³¼ ë¹„ìŠ·í•œ ì˜ë¯¸
- State : Reactorì—ì„œ ìƒì„±ëœ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ê²°ê³¼(ì˜ˆë¥¼ë“¤ì–´, ë²„íŠ¼ì˜ ìƒíƒœë³€í™”)ê°€ Viewë¡œ ì „ë‹¬ë˜ëŠ” í˜•íƒœ(ë‹¨ìœ„)

ì¦‰, MVVM + Input/Output íŒ¨í„´ì—ì„œì˜ Inputì´ Action, Outputì´ Stateì™€ ê°™ë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.

## ReactorKit ì‚¬ìš© ëª©ì 

- Testablility : MVVM íŒ¨í„´ì˜ ê°€ì¥ í° ì´ì  ì¤‘ í•˜ë‚˜ëŠ” ë°”ë¡œ <b>í…ŒìŠ¤íŠ¸ ìœ ìš©ì„±(Testablility)</b>ì´ë‹¤. <br />ë·°ì™€ ë·°ëª¨ë¸ë¡œ ë¶„ë¦¬í•˜ì—¬ ë·°ê°€ ì™„ì„±ëœ í˜•íƒœê°€ ì•„ë‹ˆë”ë¼ë„ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥ì¼€í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ëŠ” ì‹œì ì„ í›¨ì”¬ ë” ì•ë‹¹ê¸¸ ìˆ˜ ìˆë‹¤.
- Start Small : Input/Output íŒ¨í„´ì´ ì‚¬ìš©ëœ í”„ë¡œì íŠ¸ë“¤ì„ ì‚´í´ë³´ë©´, í”„ë¡œì íŠ¸ ì „ì²´ì— íŒ¨í„´ì— ì ìš©ëœê²ƒì´ ë³´ì¸ë‹¤. ì´ëŠ”, ê°„ë‹¨í•œ ë¡œì§ì´ë¼ë„ Input/OutputíŒ¨í„´ì„ ì ìš©ì‚¬ì¼œì•¼ í•œë‹¤ëŠ” ëœ»ì´ë©°, ì´ëŠ” ê°œë°œìì—ê²Œ í”¼ë¡œê°ì„ ì•ˆê²¨ì£¼ê²Œëœë‹¤.<br /> ë°˜ëŒ€ë¡œ, <b>ReactorKitì€ í•„ìš”í•˜ë‹¤ê³  ìƒê°ë˜ëŠ” ë¶€ë¶„ì—ë§Œ ì ìš©ì‹œí‚¬ ìˆ˜ ìˆë‹¤.</b> ì´ëŠ” í”„ë¡œì­íŠ¸ ê°œë°œë‹¨ê³„ í˜¹ì€ ë¦¬íŒ©í† ë§ë‹¨ê³„ì—ì„œ ì†Œìš”ë˜ëŠ” ê°œë°œìì˜ ì‹œê°„ê³¼ í”¼ë¡œê°ì„ ê°ì†Œì‹œì¼œì¤€ë‹¤.
- Less Typing : í”„ë ˆì„ì›Œí¬ë¡œ ì •í˜•í™”ì‹œì¼œ, ê°œë°œìë“¤ì´ ë¨¸ë¦¬ì¨ì„œ ìƒê°í•´ì•¼í•  ì½”ë“œë“¤ì„ ë” ê°„ê²°í•˜ê²Œ ë§Œë“¤ì–´ë‚¼ ìˆ˜ ìˆë‹¤.

## View

View(UIVIew ê°€ ì•„ë‹ˆë‹¤!)ëŠ” ReactorKitì˜ í”„ë¡œí† ì½œë¡œì„œ ì‚¬ìš©ë˜ë©°, VCì™€ Cellì—ì„œ í˜¸ì¶œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì„ ì–¸ëœë‹¤. 
```swift
class ProfileViewController: UIViewController, View {
  var disposeBag = DisposeBag()
}
profileViewController.reactor = UserViewReactor() // inject reactor
```
ë§ ê·¸ëŒ€ë¡œ, ë°ì´í„°ë¥¼ í™”ë©´ì— ë³´ì—¬ì£¼ëŠ” ì—­í• ì„ ìˆ˜í–‰í•˜ê³  View ì—ì„œ ë°œìƒëœ ì´ë²¤íŠ¸ë“¤ì„ ì•¡ì…˜ ìŠ¤íŠ¸ë¦¼ì— bindí•˜ê³  UI ì»´í¬ë„ŒíŠ¸ì— stateë¥¼ ì ìš©ì‹œí‚¨ë‹¤.

VCë‚˜ Cellì— Viewë¼ëŠ” í”„ë¡œí† ì½œì„ ì ìš©ì‹œí‚¤ë©´ ìë™ìœ¼ë¡œ typealias í‚¤ì›Œë“œë¥¼ ê°€ì§„í˜•íƒœë¡œ Reactorë¥¼ ë°”ì¸ë”©í•˜ë„ë¡ ë‚˜ì˜¨ë‹¤. 

reactorê°€ í• ë‹¹ë˜ë©´ ìë™ìœ¼ë¡œ .bind(reactor:) í•¨ìˆ˜ê°€ í˜¸ì¶œëœë‹¤. .bind(reactor:) í•¨ìˆ˜ëŠ” action ìŠ¤íŠ¸ë¦¼ê³¼ state ìŠ¤íŠ¸ë¦¼ì„ ë¬¶ì–´ì£¼ëŠ” ì—­í• ì„ ìˆ˜í–‰í•œë‹¤.
```swift
func bind(reactor: ProfileViewReactor) {
  // action (View -> Reactor)
  refreshButton.rx.tap.map { Reactor.Action.refresh }
    .bind(to: reactor.action)
    .disposed(by: self.disposeBag)

  // state (Reactor -> View)
  reactor.state.map { $0.isFollowing }
    .bind(to: followButton.rx.isSelected)
    .disposed(by: self.disposeBag)
}
```

## ìŠ¤í† ë¦¬ë³´ë“œ ì§€ì›

ìŠ¤í† ë¦¬ë³´ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” VCì— StoryboardView í”„ë¡œí† ì½œì„ ì‚¬ìš©í•´ì•¼í•œë‹¤ View í”„ë¡œí† ì½œê³¼ì˜ ì°¨ì´ì ì€ ë”± í•˜ë‚˜ì¸ë°, ë°”ë¡œ viewDidLoad()ê°€ ëª¨ë‘ ì§„í–‰ ëœ ì´í›„ì— .bind(reactor:) í•¨ìˆ˜ê°€ í˜¸ì¶œëœë‹¤ëŠ” ì ì´ë‹¤.

## Reactor

ReactorëŠ” UIì™€ ë…ë¦½ëœ ê³„ì¸µìœ¼ë¡œ, viewì˜ stateaë¥¼ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•œë‹¤. reactorì˜ ê°€ì¥ í° ì—­í• ì€ viewì—ì„œ ë‚˜ì˜¤ëŠ” ì œì–´ íë¦„(control flow)ë¥¼ ë¶„ë¦¬í•˜ëŠ” ì—­í• ì´ë‹¤. ëª¨ë“  viewëŠ” ê°ê° ìƒì‘í•˜ëŠ” redactorê°€ ìˆìœ¼ë©°, ëª¨ë“  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ reactorì— deleagte ì‹œí‚¨ë‹¤. readctorì€ viewì™€ì˜ dependencyê°€ ì—†ê¸°ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸í™˜ê²½ì´ ë” ì‰½ê²Œ êµ¬ì¶•ëœë‹¤.

reactorëŠ” Reactor í”„ë¡œí† ì½œì„ ì ìš©í•˜ëŠ”ê²ƒìœ¼ë¡œ ì‹œì‘í•˜ê³ , Action, Mutation, State, initialStateë¥¼ ì •ì˜í•´ì•¼ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤. Action, Mutationì€ enumìœ¼ë¡œ, StateëŠ” struct í˜•íƒœë¡œ ì„ ì–¸ì´ ê°€ëŠ¥í•˜ë‹¤.

```swift
class ProfileViewReactor: Reactor {
  // represent user actions
  enum Action {
    case refreshFollowingStatus(Int)
    case follow(Int)
  }

  // represent state changes
  enum Mutation {
    case setFollowing(Bool)
  }

  // represents the current view state
  struct State {
    var isFollowing: Bool = false
  }

  let initialState: State = State()
}
```

![image](https://user-images.githubusercontent.com/48994081/187618297-f34d1371-b020-41a5-847e-a47a197d2e3f.png)


ìœ„ ê·¸ë¦¼ì—ì„œ ê°ê°ì˜ ì˜ë¯¸ì€,
- Action : ì‚¬ìš©ìì˜ ìƒí˜¸ì‘ìš©ì„ ì˜ë¯¸í•œë‹¤.
- State : ë·°ì˜ stateë¥¼ ì˜ë¯¸í•œë‹¤.
- Mutation : Actionê³¼ Stateì˜ ì—°ê²°ê³ ë¦¬ë¥¼ ì˜ë¯¸í•œë‹¤.

reactorëŠ” action ìŠ¤íŠ¸ë¦¼ì„ mutate()ì™€ reduce() ë‘ ë‹¨ê³„ë¡œ action ìŠ¤íŠ¸ë¦¼ì—ì„œ state ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë°”ê¾¼ë‹¤.

### mutate()

Actionì„ ìˆ˜ì‹ ë°›ì•„ `Observable<Mutaion>` í˜•íƒœë¡œ ìƒì„±í•œë‹¤.

```swift
func mutate(action: Action) -> Observable<Mutation>
```

```swift
func mutate(action: Action) -> Observable<Mutation> {
  switch action {
  case let .refreshFollowingStatus(userID): // actionì„ ì „ë‹¬ë°›ìŒ
    return UserAPI.isFollowing(userID) // API ìŠ¤íŠ¸ë¦¼ì„ ìƒì„±í•¨
      .map { (isFollowing: Bool) -> Mutation in
        return Mutation.setFollowing(isFollowing) // Mutaion ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë³€í™˜í•¨
      }
  case let .follow(userID):
    return UserAPI.follow()
      .map { _ -> Mutation in
        return Mutation.setFollowing(true)
      }
  }
}
```

### reduce()
ì´ì „ì˜ Stateì™€ Mutaionìœ¼ë¡œë¶€í„° ìƒˆë¡œìš´ Stateë¥¼ ìƒì„±í•œë‹¤.

```swift
func reduce(state: State, mutation: Mutation) -> State
```
```swift
func reduce(state: State, mutation: Mutation) -> State {
  var state = state // ì´ì „ stateë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜´
  switch mutation {
  case let .setFollowing(isFollowing):
    state.isFollowing = isFollowing // ìƒˆë¡œìš´ stateë¥¼ ìƒì„±í•˜ê³  ì´ì „ stateë¥¼ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë†“ìŒ
    return state // ìƒˆë¡œìš´ stateë¥¼ ë°˜í™˜í•¨
  }
}
```

ìœ„ ì˜ˆì œ ì½”ë“œì—ì„œ ë´¤ë“¯ì´, reduce()ëŠ” ìˆœìˆ˜í•œ í•¨ìˆ˜ì˜ ì—­í• ë§Œ í•œë‹¤. APIí˜¸ì¶œê³¼ ê°™ì€ side effectëŠ” í˜¸ì¶œë˜ì–´ì„œëŠ” ì•ˆëœë‹¤.

## Global State and transform()
ì§€ê¸ˆê¹Œì§€ ë°°ìš´ ë‚´ìš©ì— ë”°ë¥´ë©´, ìŠ¤íŠ¸ë¦¼ì„ ì œì–´í•˜ëŠ” ì ˆì°¨ëŠ” Action -> Mutation -> State ì ˆì°¨ë¡œ í˜ëŸ¬ê°€ëŠ”ê²ƒìœ¼ë¡œ ì•Œê³ ìˆì„ê²ƒì´ë‹¤.
í•˜ì§€ë§Œ, ì´ ì ˆì°¨(flow)ëŠ” Global Stateê°€ ì•„ë‹ˆë‹¤.

#### â“Global State ëŠ” ë¬´ì—‡ì¸ê°€ìš”?
ì „ì—­ ìƒíƒœ(Global State)ë¼ëŠ” ë§ì˜ ì˜ë¯¸ëŠ”, ëª¨ë“ ê³³(ì—¬ëŸ¬ê³³)ì—ì„œ ì˜í–¥ì„ ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸(ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼)ì´ë¼ëŠ” ëœ»ì´ë©° 1:Nì˜ ì—°ê²°ì„ ê°€ì§„ ìŠ¤íŠ¸ë¦¼ì„ ë§í•œë‹¤.

ê·¸ë ‡ë‹¤ë©´, ì´ë¯¸ ì§„í–‰í–ˆë˜ í”„ë¡œì íŠ¸ì—ì„œ ì „ì—­ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ êµ¬ì„±í•´ë†¨ë˜ ì‘ì—…ì€ ì „ë¶€ ë¦¬íŒ©í† ë§í•´ì•¼í•˜ëŠ”ê°€? 
### ì•„ë‹ˆë‹¤!
ë°”ë¡œ .transform() í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ì „ì—­ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ì„ í•©ì¹˜ëŠ” ë°©ì‹ì´ë‚˜ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì „ì—­ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ì„ action, mutation, state ë¡œ ë³€í™˜í•  ìˆ˜ ìˆë‹¤.

.transform() í•¨ìˆ˜ëŠ” íŒŒë¼ë¯¸í„°ë¡œ action, mutation, stateíƒ€ì…ì„ ê°€ì§„ ì˜µì €ë²„ë¸”ì„ ê°™ì€ í˜•íƒœë¡œ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤. í•¨ìˆ˜ì˜ ê¸°ëŠ¥ì€ ë‹¤ë¥¸ ì˜µì €ë²„ë¸” ìŠ¤íŠ¸ë¦¼ì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë°›ì€ ì˜µì €ë²„ë¸”ê³¼ í•©ì¹œ í›„ ë³€í™˜í•˜ëŠ” ê¸°ëŠ¥ì„ ê°€ì§€ê³ ìˆë‹¤.


```swift
var currentUser: BehaviorSubject<User> // global state

func transform(mutation: Observable<Mutation>) -> Observable<Mutation> {
  return Observable.merge(mutation, currentUser.map(Mutation.setUser))
}
```

## View ê°„ì˜ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜

![image](https://user-images.githubusercontent.com/48994081/187837547-2064f9ce-7e8c-4686-8310-a25fe5af9c7e.png)

ë³¸ë¬¸ ë§¨ ì²˜ìŒì— ì–˜ê¸°í–ˆë˜ ë‚´ìš©ì²˜ëŸ¼, ReactorKitì€ RxSwfit(Reactive Programming)ì— ì í•©í•œ í”„ë ˆì„ì›Œí¬ì´ë‹¤. ë·° ê°„ì˜ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì€ ë·°ë¥¼ UIButton, UILabel ì²˜ëŸ¼ ë‹¤ë¤„ì¤˜ì•¼í•˜ëŠ”ë°, ì´ ë°©ì‹ì˜ ëŒ€í‘œë¡œëŠ” ControlEvent, UIButton.rx.tap ì´ ìˆë‹¤.

## í…ŒìŠ¤íŠ¸
ReactorKitì€ ë‚´ì¥ëœ í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ë” ì‰½ê³  ë¹ ë¥´ê²Œ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.

#### ë¬´ì—‡ì„ í…ŒìŠ¤íŠ¸ í• ê²ƒì¸ê°€?
ì¼ë‹¨, View í˜¹ì€ Reactor ì¤‘ ì–´ë–¤ê²ƒì„ í…ŒìŠ¤íŠ¸ í•  ì§€ ê²°ì •í•´ì•¼í•œë‹¤.
- View : ì‚¬ìš©ìì˜ ìƒí˜¸ì‘ìš©ìœ¼ë¡œì¸í•œ ì í•©í•œ Actionì´ Reactorì´ ì „ë‹¬ë˜ëŠ”ê°€ / Viewê°€ Stateì— ë³€í™”ì— ë”°ë¼ ì í•©í•˜ê²Œ ì„¤ì •ë˜ì–´ ìˆëŠ”ê°€
- Reactor : Actionê³¼ ì í•©í•˜ê²Œ Stateê°€ ë³€ê²½ë˜ì—ˆëŠ”ê°€

### View í…ŒìŠ¤íŠ¸

Reactorì˜ stub ê¸°ëŠ¥ì„ í™œìš©í•˜ë©´ Viewë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤. Reactor.isStubEnabled ì„ í™œì„±í™”í•˜ë©´ Reactorê°€ ë°›ì€ Actionì„ ëª¨ë‘ ê¸°ë¡í•˜ê³ , mutate(), reduce() í•¨ìˆ˜ëŒ€ì‹  í…ŒìŠ¤íŠ¸í™˜ê²½ì— ë§ê²Œ ì™¸ë¶€ì—ì„œ ìƒíƒœë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

stubì€ ì•„ë˜ 3ê°œì˜ í”„ë¡œí¼í‹°ë¥¼ ê°€ì§„ë‹¤.

```swift
var state: StateRelay<Reactor.State> { get }
var action: ActionSubject<Reactor.Action> { get }
var actions: [Reactor.Action] { get } // recorded actions
```

í…ŒìŠ¤íŠ¸ í•˜ëŠ” ì˜ˆì œ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```swift
func testAction_refresh() {
  // 1. Stub ë¦¬ì•¡í„°ë¥¼ ì¤€ë¹„
  let reactor = MyReactor()
  reactor.isStubEnabled = true

  // 2. Stub ë¦¬ì•¡í„°ë¥¼ ì£¼ì…í•œ ë·°ë¥¼ ì¤€ë¹„
  let view = MyView()
  view.reactor = reactor

  // 3. ì‚¬ìš©ì ìƒí˜¸ì‘ìš©ì„ ì‹¤í–‰
  view.refreshControl.sendActions(for: .valueChanged)

  // 4. ì•¡ì…˜ì´ ì˜¬ë°”ë¥´ê²Œ ì „ë‹¬ë˜ì—ˆëŠ”ì§€ ê²€ì¦
  XCTAssertEqual(reactor.stub.actions.last, .refresh)
}

func testState_isLoading() {
  // 1. Stub ë¦¬ì•¡í„°ë¥¼ ì¤€ë¹„
  let reactor = MyReactor()
  reactor.isStubEnabled = true

  // 2. Stub ë¦¬ì•¡í„°ë¥¼ ì£¼ì…í•œ ë·°ë¥¼ ì¤€ë¹„
  let view = MyView()
  view.reactor = reactor

  // 3. ë¦¬ì•¡í„°ì˜ ìƒíƒœë¥¼ ì„¤ì •
  reactor.stub.state.value = MyReactor.State(isLoading: true)

  // 4. ë·° ì»´í¬ë„ŒíŠ¸ê°€ ì˜¬ë°”ë¥´ê²Œ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ê²€ì¦
  XCTAssertEqual(view.activityIndicator.isAnimating, true)
}
```

### Reactor í…ŒìŠ¤íŠ¸
Reactorì€ ì•„ë˜ ì˜ˆì‹œ ì½”ë“œì™€ ê°™ì´ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.

```swift
func testIsBookmarked() {
  let reactor = MyReactor()
  reactor.action.onNext(.toggleBookmarked)
  XCTAssertEqual(reactor.currentState.isBookmarked, true)
  reactor.action.onNext(.toggleBookmarked)
  XCTAssertEqual(reactor.currentState.isBookmarked, false)
}
```
í•˜ì§€ë§Œ, ëª‡ëª‡ StateëŠ” í•œë²ˆì˜ Actionìœ¼ë¡œ ì—¬ëŸ¬ë²ˆ ë°”ë€ŒëŠ” ê²½ìš°ê°€ìˆë‹¤. ì´ëŸ´ë•ŒëŠ” [RxTest](https://github.com/ReactiveX/RxSwift) í˜¹ì€ [RxExpect](https://github.com/devxoul/RxExpect)ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²ƒì´ ë°”ëŒì§í•˜ë‹¤.

ì•„ë˜ëŠ” RxTestë¥¼ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•œ ì˜ˆì‹œ ì½”ë“œì´ë‹¤.

```swift
func testIsLoading() {
  // given
  let scheduler = TestScheduler(initialClock: 0)
  let reactor = MyReactor()
  let disposeBag = DisposeBag()

  // when
  scheduler
    .createHotObservable([
      .next(100, .refresh) // send .refresh at 100 scheduler time
    ])
    .subscribe(reactor.action)
    .disposed(by: disposeBag)

  // then
  let response = scheduler.start(created: 0, subscribed: 0, disposed: 1000) {
    reactor.state.map(\.isLoading)
  }
  XCTAssertEqual(response.events.map(\.value.element), [
    false, // initial state
    true,  // just after .refresh
    false  // after refreshing
  ])
}
```

## ìŠ¤ì¼€ì¥´ë§
scheduler í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ìŠ¤ì¼€ì¥´ëŸ¬ì—ì„œ state ìŠ¤íŠ¸ë¦¼ì„ ê´€ì¸¡í•  ìˆ˜ ìˆë‹¤. ë°˜ë“œì‹œ <b>serial queue<b>ì´ì–´ì•¼ í•˜ë©°, ê¸°ë³¸ê°’ìœ¼ë¡œëŠ” MainScheduelerê°€ ì„¤ì •ë˜ì–´ìˆë‹¤.

```swift
final class MyReactor: Reactor {
  let scheduler: Scheduler = SerialDispatchQueueScheduler(qos: .default)

  func reduce(state: State, mutation: Mutation) -> State {
    // executed in a background thread
    heavyAndImportantCalculation()
    return state
  }
}
```

## í„ìŠ¤
í„ìŠ¤ëŠ” ìƒˆë¡œìš´ ê°’ì´ í• ë‹¹ë˜ì—ˆì„ë•Œ(ì´ì „ê³¼ ê°™ì€ ê°’ì„ ê°€ì ¸ë„)ë§Œ ì´ë²¤íŠ¸ë¥¼ ë°›ê³ ì‹¶ì„ë•Œ ì‚¬ìš©í•œë‹¤.

```swift
// Reactor
private final class MyReactor: Reactor {
  struct State {
    @Pulse var alertMessage: String?
  }

  func mutate(action: Action) -> Observable<Mutation> {
    switch action {
    case let .alert(message):
      return Observable.just(Mutation.setAlertMessage(message))
    }
  }

  func reduce(state: State, mutation: Mutation) -> State {
    var newState = state

    switch mutation {
    case let .setAlertMessage(alertMessage):
      newState.alertMessage = alertMessage
    }

    return newState
  }
}

// View
reactor.pulse(\.$alertMessage)
  .compactMap { $0 } // filter nil
  .subscribe(onNext: { [weak self] (message: String) in
    self?.showAlert(message)
  })
  .disposed(by: disposeBag)

// Cases
reactor.action.onNext(.alert("Hello"))  // showAlert() is called with `Hello`
reactor.action.onNext(.alert("Hello"))  // showAlert() is called with `Hello`
reactor.action.onNext(.doSomeAction)    // showAlert() is not called
reactor.action.onNext(.alert("Hello"))  // showAlert() is called with `Hello`
reactor.action.onNext(.alert("tokijh")) // showAlert() is called with `tokijh`
reactor.action.onNext(.doSomeAction)    // showAlert() is not called
```

ìœ„ ì—ì‹œ ì½”ë“œë¥¼ ë³´ë©´, í„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ Hello ë¼ëŠ” ê°’ì„ ë‘ë²ˆ ì „ë‹¬í•˜ì—¬ë„ ì •ìƒì ìœ¼ë¡œ ìˆ˜ì‹ ë˜ë©°, ê°’ì„ í• ë‹¹í•˜ì§€ ì•ŠëŠ” .doSomeAction ì—ëŠ” showALert() í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

